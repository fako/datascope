

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Processors &mdash; Data Growth 0.17.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Data Growth 0.17.0 documentation" href="../index.html"/>
        <link rel="next" title="Utils" href="../utils/index.html"/>
        <link rel="prev" title="Configurations" href="../configuration/index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html" class="icon icon-home"> Data Growth
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">Resources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../resources/index.html#getting-started">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources/index.html#http-resource">Http Resource</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../resources/index.html#basic-usage">Basic usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../resources/index.html#downloading-files">Downloading files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../resources/index.html#customize-requests">Customize requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../resources/index.html#continuation-requests">Continuation requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../resources/index.html#authenticating-requests">Authenticating requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../resources/index.html#shell-resource">Shell Resource</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../resources/index.html#specify-command">Specify command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../resources/index.html#cleaning-output">Cleaning output</a></li>
<li class="toctree-l3"><a class="reference internal" href="../resources/index.html#working-directory">Working directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../resources/index.html#environment">Environment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../resources/index.html#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../resources/index.html#caching-behaviour">Caching behaviour</a></li>
<li class="toctree-l3"><a class="reference internal" href="../resources/index.html#user-agent-configuration">User Agent configuration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configurations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.html#getting-started">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.html#django-fields">Django fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.html#updating">Updating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.html#serializers">Serializers</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Processors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#input">Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-made">Custom made</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utils/index.html">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../resources/reference.html">Resources</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../resources/reference.html#module-datagrowth.resources.base">Resource (base class)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../resources/reference.html#module-datagrowth.resources.http">Http</a></li>
<li class="toctree-l3"><a class="reference internal" href="../resources/reference.html#module-datagrowth.resources.shell">Shell</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/reference.html">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../configuration/reference.html#module-datagrowth.configuration.types">Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration/reference.html#module-datagrowth.configuration.fields">Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration/reference.html#module-datagrowth.configuration.serializers">Serializers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference.html">Processors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference.html#module-datagrowth.processors.base">Processor (base class)</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference.html#module-datagrowth.processors.input.extraction">ExtractProcessor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../utils/reference.html">Utils</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils/reference.html#module-datagrowth.utils.iterators">Iterators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/reference.html#module-datagrowth.utils.datetime">Datetime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/reference.html#module-datagrowth.utils.io">Input/Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/reference.html#module-datagrowth.utils.data">Data</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Data Growth</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Processors</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/processors/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="processors">
<h1>Processors<a class="headerlink" href="#processors" title="Permalink to this headline">¶</a></h1>
<p>A processor is a plain Python class that inherits from the <code class="docutils literal notranslate"><span class="pre">Processor</span></code> class and that processes data in some way.
For instance to do extraction, transformation and loading of data (ETL).</p>
<p>Processors have two important properties:</p>
<blockquote>
<div><ul class="simple">
<li><p>They take <a class="reference external" href="../configuration/index.html">configurations</a> during initialisations, which can be used during processing</p></li>
<li><p>If declarations of processors occur in the <code class="docutils literal notranslate"><span class="pre">processors</span></code> module of a Django app it’s possible to load a processor by name</p></li>
</ul>
</div></blockquote>
<p>These properties make it trivial to dispatch a task with the name of the processor (as a string) and some configuration (as JSON)
to for instance Celery and do parallel processing and/or processing in a pipeline fashion.</p>
<p>You can create your own processors or use pre-made processors from a Django app.
To start using Datagrowth processors include datagrowth as an app in your <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> setting</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">...</span>
    <span class="s1">&#39;datagrowth&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The first type of processors that Datagrowth ships with is processors that handle input.</p>
<div class="section" id="input">
<h2>Input<a class="headerlink" href="#input" title="Permalink to this headline">¶</a></h2>
<p>Very often when gathering data you’re only interested in part of the data and can discard the rest.
The <code class="docutils literal notranslate"><span class="pre">ExtractProcessor</span></code> is a processor that helps you to extract data from common formats like JSON, HTML and XML.</p>
<p>Let’s imagine a scenario where you want to get the <code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">description</span></code> of objects in a JSON response
that are stored under the <code class="docutils literal notranslate"><span class="pre">results</span></code> key. Together with this you want to store the source of these objects,
which is stored under the <code class="docutils literal notranslate"><span class="pre">source</span></code> inside a <code class="docutils literal notranslate"><span class="pre">metadata</span></code> object.
It can be useful to store metadata such as a source together with the actual data for later processing.</p>
<p>In order to handle the scenario described above with the <code class="docutils literal notranslate"><span class="pre">ExtractProcessor</span></code>.
You would have to write a configuration as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>from datagrowth.config import create_config
from datagrowth.processors import ExtractProcessor


config = create_config(&quot;extract_processor&quot;, {

    # Objectives indicate what data you want to retrieve from a source
    &quot;objective&quot;: {

        &quot;@&quot;: &quot;$.results&quot;,  # &#39;@&#39; value specifies where to start extraction
        &quot;#source&quot;: &quot;$.metadata.source&quot;,  # this value is the same for all results

        # Objective items not starting with &#39;@&#39; or &#39;#&#39;
        # are looked up in the context of the &#39;@&#39; item
        &quot;name&quot;: &quot;$.name&quot;,
        &quot;description: &quot;$.description&quot;
    }

}

extractor = ExtractProcessor(config=config)
results = extractor.extract(&quot;application/json&quot;, &quot;&quot;&quot;{
    &quot;metadata&quot;: {&quot;source&quot;: &quot;data tooling&quot; ... more keys you don&#39;t need }
    &quot;results&quot;: [
        {&quot;name&quot;: &quot;datagrowth&quot;, description&quot;: &quot;data mash up&quot; ... more keys you don&#39;t need},
        {&quot;name&quot;: &quot;scrappy&quot;, description&quot;: &quot;website scraping&quot; ... more keys you don&#39;t need}
    ]
}&quot;&quot;&quot;)

print(results)
# out: [{&quot;name&quot;: &quot;datagrowth&quot;, description&quot;: &quot;data mash up&quot;, &quot;source&quot;: &quot;data tooling&quot;}, ...]
</pre></div>
</div>
<p>In this case the objective values are JSON paths.
These paths point to the data that should get extracted and ignore the rest.
Read more about how they work at the <a class="reference external" href="../utils/reference.html#datagrowth.utils.data.reach">reach function documentation</a></p>
<p>Instead of JSON paths you can use BeautifulSoup expressions to extract from HTML and XML.
Let’s imagine a scenario where we want to get data from an unsorted HTML list.
The title of each item we want to store as <code class="docutils literal notranslate"><span class="pre">name</span></code> and the content as <code class="docutils literal notranslate"><span class="pre">description</span></code>.
Lastly the <code class="docutils literal notranslate"><span class="pre">source</span></code> will come from the title element of the page.</p>
<p>For that the <code class="docutils literal notranslate"><span class="pre">ExtractProcessor</span></code> configuration looks like this</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="kn">from</span> <span class="nn">datagrowth.config</span> <span class="kn">import</span> <span class="n">create_config</span>
<span class="kn">from</span> <span class="nn">datagrowth.processors</span> <span class="kn">import</span> <span class="n">ExtractProcessor</span>


<span class="n">config</span> <span class="o">=</span> <span class="n">create_config</span><span class="p">(</span><span class="s2">&quot;extract_processor&quot;</span><span class="p">,</span> <span class="p">{</span>

    <span class="c1"># Objectives indicate what data you want to retrieve from a source</span>
    <span class="s2">&quot;objective&quot;</span><span class="p">:</span> <span class="p">{</span>

        <span class="c1"># The objective items below can use the &quot;soup&quot; variable</span>
        <span class="c1"># which is the passed BeautifulSoup instance</span>
        <span class="s2">&quot;@&quot;</span><span class="p">:</span> <span class="s2">&quot;soup.find_all(&#39;li&#39;)&quot;</span><span class="p">,</span>  <span class="c1"># &#39;@&#39; value specifies where to start extraction</span>
        <span class="s2">&quot;#source&quot;</span><span class="p">:</span> <span class="s2">&quot;soup.find(&#39;title&#39;).text&quot;</span><span class="p">,</span>  <span class="c1"># this value is the same for all results</span>

        <span class="c1"># Objective items not starting with &#39;@&#39; or &#39;#&#39;</span>
        <span class="c1"># can use the &quot;el&quot; variable which in this case is a BeautifulSoup &lt;li&gt; tag</span>
        <span class="c1"># as well as the &quot;soup&quot; variable which is the BeautifulSoup instance</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;el.attrs[&#39;title&#39;]&quot;</span><span class="p">,</span>  <span class="c1"># notice the transformation from &#39;title&#39; to &#39;name&#39;</span>
        <span class="s2">&quot;description: &quot;</span><span class="n">el</span><span class="o">.</span><span class="n">text</span><span class="s2">&quot;</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="n">extractor</span> <span class="o">=</span> <span class="n">ExtractProcessor</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;html&gt;</span>
<span class="s2">        &lt;head&gt;&lt;title&gt;data tooling&lt;/title&gt;&lt;/head&gt;</span>
<span class="s2">        &lt;body&gt;</span>
<span class="s2">            &lt;ul&gt;</span>
<span class="s2">                &lt;li title=&quot;datagrowth&quot;&gt;data mash up&lt;/li&gt;</span>
<span class="s2">                &lt;li title=&quot;scrappy&quot;&gt;website scraping&lt;/li&gt;</span>
<span class="s2">            &lt;ul&gt;</span>
<span class="s2">        &lt;/body&gt;</span>
<span class="s2">    &lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="n">soup</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="c1"># out: [{&quot;name&quot;: &quot;datagrowth&quot;, description&quot;: &quot;data mash up&quot;, &quot;source&quot;: &quot;data tooling&quot;}, ...]</span>
</pre></div>
</div>
<p>In the case above we do a little more than extraction. We also transform a <code class="docutils literal notranslate"><span class="pre">title</span></code> value into a <code class="docutils literal notranslate"><span class="pre">name</span></code> value.
That way the output of the extractor is interchangeable with the extractor from the JSON scenario.
This can be very useful when dealing with multiple different data sources.</p>
</div>
<div class="section" id="custom-made">
<h2>Custom made<a class="headerlink" href="#custom-made" title="Permalink to this headline">¶</a></h2>
<p>It can be useful to create a <code class="docutils literal notranslate"><span class="pre">Processor</span></code> that others can use
or it can be cleaner to use a <code class="docutils literal notranslate"><span class="pre">Processor</span></code> with Datagrowth where you could use other means.</p>
<p>We’ll illustrate how to create your own <code class="docutils literal notranslate"><span class="pre">Processor</span></code> and use it with an <code class="docutils literal notranslate"><span class="pre">ExtractionProcessor</span></code>.
You’ll see that when extracting HTML or XML it’s a much cleaner method than using BeautifulSoup strings.</p>
<p>First we’ll show you how an extraction configuration could look when using a custom processor</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">create_config</span><span class="p">(</span><span class="s2">&quot;extraction_processor&quot;</span><span class="p">,</span> <span class="p">{</span>

    <span class="c1"># Objectives indicate what data you want to retrieve from a source</span>
    <span class="s2">&quot;objective&quot;</span><span class="p">:</span> <span class="p">{</span>

        <span class="c1"># The DataToolingExtractor is a class we&#39;ll define later</span>
        <span class="c1"># It will have methods like get_entries and get_source</span>
        <span class="s2">&quot;@&quot;</span><span class="p">:</span> <span class="s2">&quot;DataToolingExtractor.get_entries&quot;</span><span class="p">,</span>
        <span class="s2">&quot;#source&quot;</span><span class="p">:</span> <span class="s2">&quot;DataToolingExtractor.get_source&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;DataToolingExtractor.get_name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description: &quot;</span><span class="n">DataToolingExtractor</span><span class="o">.</span><span class="n">get_description</span><span class="s2">&quot;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>The big advantage of using a processor over embedding functions in your objective directly
is that you’ll be able to serialize the objective to for instance JSON and transfer it over the wire.</p>
<p>To create the <code class="docutils literal notranslate"><span class="pre">DataToolingExtractor</span></code> that we can use with the <code class="docutils literal notranslate"><span class="pre">ExtractionProcessor</span></code>.
You’ll need to create a <code class="docutils literal notranslate"><span class="pre">processors</span></code> module and place it inside of an installed Django app.</p>
<p>Inside that module you can create processors by inheriting from the <code class="docutils literal notranslate"><span class="pre">Processor</span></code> class</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datagrowth.processors</span> <span class="kn">import</span> <span class="n">Processor</span>


<span class="k">class</span> <span class="nc">DataToolingExtractor</span><span class="p">(</span><span class="n">Processor</span><span class="p">):</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_entries</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">soup</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">soup</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">title</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">title</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">soup</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">el</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_description</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">soup</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">el</span><span class="o">.</span><span class="n">text</span>
</pre></div>
</div>
<p>You can also use processors from your own code.
There are class methods on <code class="docutils literal notranslate"><span class="pre">Processor</span></code> called <code class="docutils literal notranslate"><span class="pre">create_processor</span></code> and <code class="docutils literal notranslate"><span class="pre">get_processor_class</span></code>
that can help you do that.
Read more about them in the <a class="reference external" href="reference.html#module-datagrowth.processors.base">Processor reference</a></p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../utils/index.html" class="btn btn-neutral float-right" title="Utils" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../configuration/index.html" class="btn btn-neutral" title="Configurations" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Fako Berkers.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.17.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>